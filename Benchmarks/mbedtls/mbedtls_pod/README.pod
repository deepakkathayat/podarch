==============================================
README for mbed TLS with PodArch compatibility
==============================================

Note: Look for vanilla static binaries in mbedtls_vanilla folder.


Instructions To Compile and Run Pod Binaries
-----------------------------------------------------------------

1. Clean any of the old compilations:

   make -f Makepod clean

   Type "make -f Makepod clean" in the mbedtls_pod directory to clean up
   any of the previous compilation.


2. To compile the pod binaries type:

   make -f Makepod

   The encryption algorithm specific binaries can be found in 
   "programs/alogrithm_name" folders respectively and the test suit
   binaries can be found in the "tests/" directory.


3. To run the generated testsuite pod binaries:

   cd tests/
   sh test_pod.sh

   Type 'sh test_pod.sh' in "tests/" directory to run the test_suite pod
   binaries. 

   For un-encrypted binaries use "sh test_vanilla.sh"


===================================================
Changes to Directory structure and Source/Makefiles
===================================================

Makepod
-------------------
This is the main file which is used to make/compile the pod binaries for
mbedtls within this directory structure. Please read through the Makepod
file for better understanding of control flow. Refer above section for
usage instructions.


toolchain/
-------------------
This is the directory containing the PodArch toolchain files and executables
required for converting a normal static binary into a pod binary. This also
contains the header file "pod_header.h" which has been included in the relevant
source files to add system call wrappers for proper functioning of pods.


programs/
-------------------
1. #include "pod_header.h" statement in source files:

   This directory contains various sub-directories named after the respective
   encryption algorithms. Wihtin these sub-directories are located the source
   files where we have added the "pod_header.h" header file for pod sealing of
   certain binaries as per their requirements of public pages for encryption
   or decryption of data.


2. Makefile:

   Certain changes have been made to the makefile as well to allow easy and
   proper compilation of pod binaries which are as follows:

   i) CFLAGS variable has been appended with "-static" and "--wrap" flags to
      compile the binaries statically and with wrappers as needed by the header
      file "pod_header.h"

  ii) LOCAL_CFLAGS variable has been modified to include "toolchain/" directory
      which is needed by compiler to refer to "pod_header.h" during compilation.

 iii) Along with individual binary compilation statements and additional and 
      similar statement for compilation of object files (.o) has also been added
      which is as per the requirement of PodArch toolchain for pod sealing.


tests/
---------------------

1. #include "pod_header.h" added to "suites/helpers.function"

   The source files(.c files) within this directory are generated by a perl script
   which is executed via the "Makefile" hence to ease the inclusion of "pod_header.h"
   file to multiple source files we have added the "#include" statement to 
   "suites/helpers.function" file which is used for source file generation by the perl
   script.

2. Makefile has been modified exactly in the same way as it has been done in the
   "programs/Makefile".

3. "test_vanilla.sh" and "test_pod.sh" files contain execution commands for all binaries.
